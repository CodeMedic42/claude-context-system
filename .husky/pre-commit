#!/bin/sh

# Auto-sync shared templates to plugin bundle when shared templates change

SHARED_DIR="shared/templates"
PLUGIN_DIR="claude-plugin/templates"

# Check if any plugin template was modified directly
if git diff --cached --name-only | grep -q "^$PLUGIN_DIR/.*\.md$"; then
    echo "‚ùå ERROR: You modified files in $PLUGIN_DIR/ directly!"
    echo ""
    echo "Plugin templates should NOT be edited directly."
    echo "They are automatically synced from shared templates."
    echo ""
    echo "Please:"
    echo "  1. Undo changes to files in $PLUGIN_DIR/"
    echo "  2. Make your changes to files in $SHARED_DIR/ instead"
    echo "  3. Commit again - the pre-commit hook will sync automatically"
    echo ""
    echo "To undo the plugin template changes:"
    echo "  git restore --staged $PLUGIN_DIR/"
    echo "  git restore $PLUGIN_DIR/"
    echo ""
    exit 1
fi

# Check if any shared template was modified - if so, sync all to plugin
if git diff --cached --name-only | grep -q "^$SHARED_DIR/.*\.md$"; then
    echo "üìã Detected changes to $SHARED_DIR/"
    echo "üîÑ Syncing to $PLUGIN_DIR/..."

    # Copy all .md files from shared to plugin
    cp "$SHARED_DIR"/*.md "$PLUGIN_DIR/"

    # Stage all plugin templates for this commit
    git add "$PLUGIN_DIR"/*.md

    echo "‚úÖ Templates synced and staged"
fi
